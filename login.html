<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

  <title>Login Page</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600&display=swap" rel="stylesheet" />
  <link rel="icon" href="assets/engineering-helmet_18031478.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <style>
    #toast {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #333;
  color: #fff;
  padding: 15px 25px;
  border-radius: 8px;
  font-size: 16px;
  z-index: 9999;
  opacity: 0;
  transition: opacity 0.5s ease;
  text-align: center;
  max-width: 90%;
}

    @media screen and (max-width: 768px) {
  .sidebar {
    position: fixed;
    top: 70px;
    left: 0;
    width: 100%;
    height: auto;
    display: flex;
    overflow-x: auto;
    padding: 5px 0;
    background: #1a3b7c;
    z-index: 1000;
  }

  .sidebar ul {
    display: flex;
    flex-wrap: nowrap;
    width: 100%;
    padding: 0;
    margin: 0;
  }

  .sidebar ul li {
    display: inline-block;
    flex: 0 0 auto;
  }

  .sidebar ul li a {
    padding: 10px 15px;
    border-left: none;
    border-bottom: 3px solid transparent;
  }

  .sidebar ul li a.active,
  .sidebar ul li a:hover {
    background-color: transparent;
    border-left: none;
    border-bottom-color: #aac4ff;
  }

  /* إزالة الهامش اليمين من المحتوى الرئيسي وتعويضه بمساحة أعلى */
  main {
    margin: 0;
    margin-top: 120px; /* لتحتوي مساحة الشريط الجانبي الأفقي */
    padding: 20px 15px;
    min-height: calc(100vh - 120px);
  }

  /* تغيير تنسيق ترويسة الصفحة عند الشاشات الصغيرة */
  header {
    flex-wrap: wrap;
    padding: 15px 10px;
  }

  header nav {
    position: static;
    transform: none;
    left: auto;
    top: auto;
    margin-bottom: 10px;
    justify-content: center;
    width: 100%;
  }

  header h1 {
    font-size: 22px;
  }
}

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }
    body {
      background: url('assets/brick-wall-background.jpg') no-repeat center center/cover;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #fff;
    }
    .login-box {
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 40px;
      width: 350px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.6);
      color: #fff;
      position: relative;
    }
    .login-box h2 {
      text-align: center;
      margin-bottom: 25px;
      font-weight: 600;
    }
    .input-group {
      margin-bottom: 20px;
      position: relative;
    }
    .input-group input {
      width: 100%;
      padding: 12px 40px 12px 12px;
      border: none;
      border-radius: 25px;
      outline: none;
      background: rgba(255,255,255,0.1);
      color: #fff;
      font-size: 16px;
    }
    .input-group i {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #fff;
    }
    .options {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      margin-bottom: 20px;
    }
    .login-btn {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 25px;
      background: #fff;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s ease;
    }
    .login-btn:hover {
      background: #ddd;
    }
    .register-link {
      text-align: center;
      margin-top: 15px;
      font-size: 14px;
    }
    .register-link a {
      color: #fff;
      text-decoration: underline;
      cursor: pointer;
    }
    /* نمط نموذج نسيت كلمة السر */
    #reset-password-form {
      display: none;
      margin-top: 15px;
      text-align: center;
    }
    #reset-password-form input[type="email"] {
      width: 100%;
      padding: 12px;
      border-radius: 25px;
      border: none;
      outline: none;
      background: rgba(255,255,255,0.1);
      color: #fff;
      font-size: 16px;
      margin-bottom: 12px;
    }
    #reset-password-form button {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 25px;
      background: #2196F3;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s ease;
    }
    #reset-password-form button:hover {
      background: #1976d2;
    }
    #reset-message {
      margin-top: 10px;
      font-size: 14px;
    }
    /* تحسينات للموبايل */
    @media (max-width: 400px) {
      .login-box {
        width: 90vw;
        padding: 30px 20px;
      }
      .input-group input {
        font-size: 14px;
      }
      .login-btn, #reset-password-form button {
        font-size: 14px;
        padding: 10px;
      }
      .options, .register-link {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="login-box">
    <h2>Login</h2>
    <div class="input-group">
      <input type="text" placeholder="Username or Email" id="username" />
      <i class="fa fa-user"></i>
    </div>
    <div class="input-group">
      <input type="password" placeholder="Password" id="password" />
      <i class="fa fa-lock"></i>
    </div>
    <div class="options">
      <label><input type="checkbox" id="rememberMe" /> Remember me</label>
      <a href="#" id="show-reset-form">Forgot password?</a>
    </div>
    <button class="login-btn" onclick="login()">Login</button>
    <div id="login-message" style="margin-top: 10px; font-size: 14px; color: orange; text-align: center;"></div>
    <div class="register-link">
      Don't have an account? <a href="register.html">Register</a>
    </div>

    <!-- نموذج نسيت كلمة السر -->
    <form id="reset-password-form" onsubmit="resetPassword(event)">
      <input type="email" id="reset-email" placeholder="Enter your email" required />
      <button type="submit">Send Reset Email</button>
      <div id="reset-message"></div>
    </form>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script>
    // إعدادات Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAstL7SQukxHMOEshWXQEuM9Ju9n7UK8TI",
      authDomain: "lqa2ed.firebaseapp.com",
      databaseURL: "https://lqa2ed-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "lqa2ed",
      storageBucket: "lqa2ed.firebasestorage.app",
      messagingSenderId: "677918048293",
      appId: "1:677918048293:web:9644eab33e4f2df044ffcc"
    };
    firebase.initializeApp(firebaseConfig);

    // إظهار / إخفاء نموذج نسيت كلمة السر
    document.getElementById('show-reset-form').addEventListener('click', function(e){
      e.preventDefault();
      const form = document.getElementById('reset-password-form');
      form.style.display = form.style.display === 'block' ? 'none' : 'block';
    });

    // تسجيل الدخول مع Firebase Authentication
    function login() {
      const emailOrUsername = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      const messageBox = document.getElementById('reset-message');

      if (!emailOrUsername || !password) {
        showToast('Please enter your username/email and password');
        return;
      }

      // تسجيل الدخول باستخدام الإيميل (لو حبيت تدعم username لازم تضيف لوجيك ثاني)
      firebase.auth().signInWithEmailAndPassword(emailOrUsername, password)
.then((userCredential) => {
  const user = userCredential.user;
  if (user.emailVerified) {
    // المستخدم موثق، اسمح له بالدخول
    window.location.href = 'index.html';
  } else {
firebase.auth().signOut(); // تسجيل الخروج

const messageBox = document.getElementById('login-message');
messageBox.innerHTML = `
  Please verify your email address before logging in.
  <br>
  <button onclick="resendVerification()" style="margin-top: 8px; padding: 6px 12px; border: none; border-radius: 5px; background-color: #ffa500; color: #fff; cursor: pointer;">
    Resend Email
  </button>
`;

  }
})

        .catch(error => {
          showToast(error.message);
        });
    }
function resendVerification() {
  const user = firebase.auth().currentUser;
  if (user) {
    user.sendEmailVerification()
      .then(() => {
        document.getElementById('login-message').innerHTML = "Verification email sent. Please check your inbox.";
      })
      .catch((error) => {
        document.getElementById('login-message').innerHTML = error.message;
      });
  } else {
    document.getElementById('login-message').innerHTML = "No user is currently signed in.";
  }
}

    // استعادة كلمة السر بدون تحويل صفحة
    function resetPassword(event) {
      event.preventDefault();
      const email = document.getElementById('reset-email').value.trim();
      const resetMsg = document.getElementById('reset-message');
      resetMsg.textContent = '';

      if (!email) {
        resetMsg.style.color = 'red';
        resetMsg.textContent = 'Please enter your email.';
        return;
      }

      firebase.auth().sendPasswordResetEmail(email)
        .then(() => {
          resetMsg.style.color = 'lightgreen';
          resetMsg.textContent = 'Reset email sent! Please check your inbox.';
        })
        .catch((error) => {
          resetMsg.style.color = 'red';
          resetMsg.textContent = error.message;
        });
    }
    function showToast(message, color = '#333') {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.style.backgroundColor = color;
  toast.style.display = 'block';
  toast.style.opacity = '1';

  setTimeout(() => {
    toast.style.opacity = '0';
    setTimeout(() => {
      toast.style.display = 'none';
    }, 500);
  }, 3000); // الرسالة تختفي بعد 3 ثوانٍ
}

  </script>
  <div id="toast" style="display: none;"></div>

</body>
</html>
